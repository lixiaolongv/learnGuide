# 性能测试概念

第一步：收集需要压测接口列表
性能测试接口列表
列名包括：  
1，序号  
2，场景  
3，描述  
4，接口名称  
5，接口URL  
6，请求方式  
7，活动期间性能参考指标  
8，部署服务器  
9，开发负责人  
10，备注  

第二步： 系统性能测试方案   
一、 测试背景   
1.1. 测试目的   
为了双11使用过程中的稳定运营，采用线上压测的方式进行有效性验证。经过沟通后，通过规定业务流程类型，针对不同业务场景设计阶段性增量压测方式和集中并发压测方式对系统的负载能力进行压测评估   
二、测试范围   
2.1 河姆渡生产环境拓扑图   
研发中心 > 2, 系统性能测试方案 > 河姆渡生产拓扑.png

2.2 性能测试环境拓扑图   
研发中心 > 2, 系统性能测试方案 > 性能测试环境.png

三、测试准则   
3.1 启动准则   
河姆渡平台系统NLB、WEB应用及数据库部署配置完成；   
河姆渡平台系统各基础数据及其测试数据准备完成；   
压力控制器，执行器到位，系统软件安装完毕；   
网络配置正确，连接通畅，可以满足压力测试需求；   
测试，研发，运维人员到位；   
注：网络负载平衡（NLB）网络技术是将访问压力均衡分布到多台机器上，以此提高整个服务器集群的响应能力；

3.2 结束准则   
在计划结束日期前，完成性能测试后，提交测试报告；   

3.3 暂停准则   
系统环境变化：系统主机硬件损坏、网络终端时间超长、压力发生器损坏，系统主机需升级暂停；   
测试环境变化：服务器被临时征用，服务器环境对测试结果造成影响；   
调整测试环境资源：压测模型、数据库参数等；   
服务器配置：服务器无法达到预期指标要求；   

3.4 再次启动准则   
测试中发现的问题已解决；   
测试环境已重新准备就绪；   

四、测试模型   
4.1 业务模型   
序号	 要求覆盖的场景	实际场景名称	   描述   
1	   登录	        1，会员登录      模拟PC、移动端、小程序会员登录
注意：具体实际操作时，需要从页面HTML、接口、串联流程考虑。

4.2 性能需求指标   

2020年双11节：

2019年全平台66当天总uv 138220

核心交易相关页面的总uv	商品详情页	下单页	收银台	支付成功页面
49250	              35008	     3915	 9288	  1039

当天全平台核心交易相关页面每秒最大pv并发情况	商品详情页	下单页	收银台	支付成功页面
57	                                      17	     57	     23	       3

系统处理能力TPS   
参考2020年双11数据以及2021年66数据，通过容量测试获得峰值；
交易成功率99%， 系统资源使用率,各个服务器CPU和内存平均使用率均不大于85%
   
五、测试实施准备   
生产环境准备：   
设备	        硬件配置	软件配置	服务器IP地址
应用服务器
数据库服务器
WEB服务器
APP客户端	

测试工具准备：
工具	             功能说明
阿里云性能测试PTS	 性能测试工具
JIRA	         缺陷管理工具  
5.2 测试数据准备  
序号
数据类型
数据准备情况及要求

用户账户
500个测试账户

红包数量
500个红包

5.3 性能参数配置准备   
参考2020年双11配置与2021年66配置   

六、测试策略   
6.1 测试发起策略   
使用性能测试工具阿里云PTS生成大量虚拟用户来模拟实际并发情况，按照测试场景的典型用户配比向被测系统服务器发送交易请求，向被测系统施加业务负载。

在执行过程中，收集各项系统资源的运行状态数据，获得系统性能表现数据。

6.2 测试执行策略   
6.2.1 基准测试   
测试环境确认之后，对业务模型中涉及的每种功能做基准测试。目的是检查业务本身是否存在性能缺陷。同时为将来混合场景的性能分析提供参考依据。

测试方法：   
使用负载模拟工具编写从客户端向应用服务器发送交易请求，并接收返回结果的脚本，在系统无压力情况下重复100次，每次迭代时间等待1秒，取业务方法的平均响应时间作为衡量指标。

6.2.2 单场景测试   
单场景测试是针对业务模型中的每个交易，利用一定的并发量进行测试，获取其性能表现，并验证单个交易是否存在并发性问题。

测试方法：   
使用PTS向系统发送请求并接收返回结果，对于每个交易均使用逐层递增的并发压力进行测试，每次执行稳定运行10分钟，获得单场景的各项性能指标。

6.2.3 负载测试   
在可能发生的业务模型下，验证系统是否满足预期的性能指标。需要说明的是，预期的性能指标不一定达到系统的最大负载。

针对业务模型中确定的系统主要功能点，在并发压力下，验证系统是否满足性能指标。此指标体现为并发用户数、响应时间、系统处理能力、资源使用率等。主要关注性能指标在特定并发压力下是否达到预期要求。

负载测试涉及的操作：   
业务模型中包含的所有操作。且操作的比例按照业务模型中比例进行分配。



6.2.4 容量测试   
容量测试目的是在系统没有出现任何软件故障或主要功能仍可正常运行的状态下，获取系统的最大承载、服务能力以及系统性能表现。
使用一定的并发压力，通过逐步递增并发压力，找到系统性能拐点，获取系统最大的并发用户数。主要综合关注响应时间、并发用户数、系统处理能力、资源使用率等。



测试方法：   
容量测试采用几个不同的并发用户数对系统发起压力，检验系统性能拐点。

容量测试涉及的操作：   
业务模型中包含的所有操作。且操作的比例按照业务模型中比例进行分配。

6.2.5 浪涌测试   
验证系统在压力多次出现的情况下，是否存在异常情况。
模拟大量用户在同一时刻进行相同的业务操作，关注系统是否能在这样极端的压力冲击下正常运行。一轮浪涌测试执行5次集合点，每次间隔5-10分钟。

浪涌测试涉及的操作：   
1，模拟500用户并发点击登录   
2，模拟100用户并发点击红包领取

6.2.5 稳定性测试   
稳定性测试是为了检测多个交易在长时间的负载下，90%响应时间、系统处理能力、资源利用率、交易成功率等各项指标变化是否平稳。

测试方法：   
针对多个交易，使用负载模拟工具编写从客户端向应用服务器发送交易请求并接收返回结果的脚本，按照达到TPS峰值并发用户数的75%执行测试，执行时间长度设置为24小时。
稳定性测试使用与负载测试相同的业务模型。

6.3 测试监控策略   
主机监控：   
本次性能测试对主机的监控主要采用性能监视器对主机的资源进行监控。监控详细信息如下：

七、测试组织架构    
针对不同的角色，进行职责划分如下：    

测试管理  
1） 负责测试方案、测试计划、测试报告制定  
2） 负责组织测试方案、测试报告的评审  
3） 负责测试进度跟进、协调测试工作开展  
4） 负责测试相关文档的归档处理  

测试实施  
1） 负责测试场景设计、测试案例设计、测试脚本制作  
2） 负责测试模拟器开发
3） 负责测试数据准备、协助基础准备  
4） 负责测试工具的安装部署  
5） 负责测试任务执行、测试数据记录、测试结果分析   

应用及环境支持  
1） 负责待测系统的需求和相关应用信息确认  
2） 负责测试环境准备和基础数据准备  
3） 负责测试计划、测试方案、测试报告确认  
4） 负责测试过程中与系统相关问题的解决  
5） 配合测试工作的开展